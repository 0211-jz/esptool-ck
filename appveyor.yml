version: 0.0.{build}

platform:
    - x86

matrix:
    fast_finish: true

build_script:
    - SET PATH=C:\MinGW\bin;C:\MinGW\msys\1.0\bin;%PATH%
    - make all
    - for /f %%i in ('git describe --always') do set PRODUCT_VERSION=%%i
    - SET PRODUCT_NAME=esptool-%PRODUCT_VERSION%
    - SET PLATFORM_NAME=win32
    - SET PRODUCT_DIST_NAME=%PRODUCT_NAME%-%PLATFORM_NAME%
    - echo %PRODUCT_NAME%
    - echo %PRODUCT_DIST_NAME%
    - mkdir %PRODUCT_DIST_NAME%
    - cp esptool.exe %PRODUCT_DIST_NAME%\esptool.exe
    - 7z a %PRODUCT_DIST_NAME%.zip %PRODUCT_DIST_NAME%
    - appveyor PushArtifact %PRODUCT_DIST_NAME%.zip

deploy:
    release: $(PRODUCT_NAME)
    provider: GitHub
    auth_token:
        secure: 'PGg5fnoBpP1Omzr6f3KIYDiD8J30rretQjSl/MITRpzvSCmN88kM6VDMz1TBGZTA'
    artifact: /.*\.zip/
    draft: true
    prerelease: false
    on:
        branch: master
        appveyor_repo_tag: true
